<local:EntityWindow x:TypeArguments="local:RepairOrder"
        x:Class="AutoFix.RepairOrderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AutoFix"
        mc:Ignorable="d"
        Title="Запись на ремонт" Width="1000" SizeToContent="Height"
        ResizeMode="CanResize"
        x:Name="_this"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <local:DateOnlyConverter x:Key="dateConverter" />
        <CollectionViewSource x:Key="ItemsCVS" Source="{Binding _services}" />
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>

        <StackPanel Margin="5" Grid.RowSpan="2">
            <TextBlock>Мастер</TextBlock>
            <ComboBox x:Name="masterBox" SelectedItem="{Binding Master}" Margin="0 0 0 5" />

            <GroupBox Header="Клиент">
                <StackPanel Margin="3">
                    <TextBlock>Имя</TextBlock>
                    <TextBox Margin="0 0 0 5" Text="{Binding ClientName}" />
                    <TextBlock>Телефон</TextBlock>
                    <TextBox Margin="0 0 0 5" Text="{Binding ClientPhoneNumber}" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Автомобиль">
                <StackPanel Margin="3">
                    <TextBlock>Производитель</TextBlock>
                    <TextBox Margin="0 0 0 5" Text="{Binding VehicleManufacturer}" />
                    <TextBlock>Модель</TextBlock>
                    <TextBox Margin="0 0 0 5" Text="{Binding VehicleModel}" />
                    <TextBlock>Год выпуска</TextBlock>
                    <local:NumberBox Margin="0 0 0 5" Text="{Binding VehicleYear}" />
                </StackPanel>
            </GroupBox>
            <TextBlock>Дата начала</TextBlock>
            <DatePicker Margin="0 0 0 5" SelectedDate="{Binding StartDate, Converter={StaticResource dateConverter}}" />

            <TextBlock>Дата завершения</TextBlock>
            <DatePicker Margin="0 0 0 5" SelectedDate="{Binding FinishDate, Converter={StaticResource dateConverter}}" />

            <CheckBox Margin="0 0 0 5" IsChecked="{Binding IsCancelled}">Отменен</CheckBox>

            <TextBlock>Комментарии</TextBlock>
            <TextBox Height="50" Text="{Binding Comments}" />
        </StackPanel>

        <DockPanel Grid.Column="1" Margin="5">
            <TextBlock DockPanel.Dock="Top">Выполненные услуги</TextBlock>

            <DataGrid ItemsSource="{Binding History}" AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridComboBoxColumn Width="2*" x:Name="serviceBox" Header="Наименование" SelectedItemBinding="{Binding Service}" />
                    <DataGridTemplateColumn Width="1*" Header="Дата начала">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding StartDate, ConverterCulture=RU}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <DatePicker SelectedDate="{Binding StartDate, Converter={StaticResource dateConverter}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="1*" Header="Дата завершения">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding FinishDate, ConverterCulture=RU}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <DatePicker SelectedDate="{Binding FinishDate, Converter={StaticResource dateConverter}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    <DataGridCheckBoxColumn Width="50" Header="Отменена" Binding="{Binding IsCancelled}" />
                    <DataGridTextColumn Width="3*" Header="Комментарии" Binding="{Binding Comments}" />
                </DataGrid.Columns>
            </DataGrid>
        </DockPanel>

        <DockPanel Grid.Column="1" Grid.Row="1" Margin="5">
            <TextBlock DockPanel.Dock="Top">Использованные предметы</TextBlock>

            <DataGrid ItemsSource="{Binding WarehouseUses}" AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridComboBoxColumn Width="2*" x:Name="warehouseItemBox" Header="Предмет" SelectedItemBinding="{Binding Item}" />
                    <DataGridTextColumn Width="1*" Header="Количество" Binding="{Binding Amount}" />
                </DataGrid.Columns>
            </DataGrid>
        </DockPanel>

        <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Margin="3" Width="150" Height="30" Click="SaveButton_Click">Сохранить</Button>
            <Button Margin="3" Width="150" Height="30" Click="DeleteButton_Click">Удалить</Button>
        </StackPanel>
    </Grid>
</local:EntityWindow>
